generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mongodb"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

type HighlightComment {
  emoji     String?
  text      String?
  timestamp DateTime @db.Date
  userId    String
}

type HighlightContent {
  image String?
  text  String?
}

type HighlightPosition {
  boundingRect      HighlightScaledPosition
  pageNumber        Int
  rects             HighlightScaledPosition[]
  usePdfCoordinates Boolean?
}

type HighlightScaledPosition {
  height     Float
  width      Float
  x1         Float
  y1         Float
  x2         Float
  y2         Float
  pageNumber Int?
}

type ParsedPapersText {
  outline  String[]
  sections ParsedPapersTextSections[]
  title    String
}

type ParsedPapersTextSections {
  facts ParsedPapersTextSectionsFacts[]
  name  String
  page  Int
  text  String
}

type ParsedPapersTextSectionsFacts {
  expectedInfo String
  fact         String
  nextSource   String
  relevance    String
}

model CurriculumNode {
  id        String             @id @default(auto()) @map("_id") @db.ObjectId
  comments  HighlightComment[]
  prompt    String?
  response  String?
  timestamp DateTime           @db.Date
  parentId  String?            @db.ObjectId
  parent    CurriculumNode?    @relation("SubNodes", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children  CurriculumNode[]   @relation("SubNodes")
  Highlight Highlight?
}

model Highlight {
  id             String            @id @default(auto()) @map("_id") @db.ObjectId
  content        HighlightContent
  position       HighlightPosition
  comment        HighlightComment?
  nodeId         String?           @unique @db.ObjectId
  node           CurriculumNode?   @relation(fields: [nodeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  annotatedPdf   AnnotatedPdf      @relation(fields: [annotatedPdfId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  annotatedPdfId String            @db.ObjectId
}

model AnnotatedPdf {
  id         String      @id @default(auto()) @map("_id") @db.ObjectId
  highlights Highlight[]
  source     String
  userId     String
}

model User {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  clerk_id   String
  email      String
  first_name String
  followers  String[]
  follows    String[]
  handle     String
  last_name  String
}

model ParsedPapers {
  id     String           @id @default(auto()) @map("_id") @db.ObjectId
  source String
  text   ParsedPapersText
  title  String
}
